{"version":3,"sources":["../../src/plugin/i18n.js"],"names":["translateMessages","err","i18n","modelName","constructor","name","options","model","_options","Object","keys","errors","forEach","errorKey","key","namespace","path","kind","value","min","max","minLength","maxLength","fieldTranslationKey","fieldName","exists","t","message","errorMiddleware","doc","next","call","i18nPlugin","schema","methods","setOptions","post"],"mappings":";;;;;AAAA,SAASA,iBAAT,CAA2BC,GAA3B,EAAgC;;AAE5B,QAAIC,aAAJ;AAAA,QAAUC,kBAAV;AACA,QAAI,KAAKC,WAAL,CAAiBC,IAAjB,KAA0B,OAA9B,EAAuC;AACnCH,eAAO,KAAKI,OAAL,CAAaJ,IAApB;AACAC,oBAAY,KAAKI,KAAL,CAAWJ,SAAvB;AACH,KAHD,MAGO,IAAI,KAAKC,WAAL,CAAiBC,IAAjB,KAA0B,OAA9B,EAAuC;AAC1C,YAAI,CAAC,KAAKG,QAAV,EAAoB;AACpBN,eAAO,KAAKM,QAAL,CAAcN,IAArB;AACAC,oBAAY,KAAKC,WAAL,CAAiBD,SAA7B;AACH;;AAED,QAAI,CAACD,IAAL,EAAW;;AAEXO,WAAOC,IAAP,CAAYT,IAAIU,MAAhB,EAAwBC,OAAxB,CAAgC,eAAO;;AAEnC,YAAMC,WAAWZ,IAAIU,MAAJ,CAAWG,GAAX,CAAjB;AACA,YAAMC,uBAAqBZ,SAA3B;AAHmC,YAI3Ba,IAJ2B,GAI2BH,QAJ3B,CAI3BG,IAJ2B;AAAA,YAIrBC,IAJqB,GAI2BJ,QAJ3B,CAIrBI,IAJqB;AAAA,YAIfC,KAJe,GAI2BL,QAJ3B,CAIfK,KAJe;AAAA,YAIRC,GAJQ,GAI2BN,QAJ3B,CAIRM,GAJQ;AAAA,YAIHC,GAJG,GAI2BP,QAJ3B,CAIHO,GAJG;AAAA,YAIEC,SAJF,GAI2BR,QAJ3B,CAIEQ,SAJF;AAAA,YAIaC,SAJb,GAI2BT,QAJ3B,CAIaS,SAJb;;AAKnC,YAAMC,sBAAyBR,SAAzB,SAAsCC,IAAtC,UAAN;AACA,YAAMQ,YAAYtB,KAAKuB,MAAL,CAAYF,mBAAZ,KAAoCrB,KAAKwB,CAAL,CAAOH,mBAAP,CAAtD;;AAEA;AACAV,iBAASc,OAAT,GAAmBzB,KAAKwB,CAAL,CAAO,CAAIX,SAAJ,SAAiBC,IAAjB,oBAAoCC,IAApC,kBAA0DA,IAA1D,CAAP,EAA0E,EAAEO,oBAAF,EAAaN,YAAb,EAAoBC,QAApB,EAAyBC,QAAzB,EAA8BC,oBAA9B,EAAyCC,oBAAzC,EAA1E,CAAnB;AACArB,YAAI0B,OAAJ,GAAczB,KAAKwB,CAAL,CAAO,oBAAP,CAAd;AAEH,KAZD;AAcH;;AAED,SAASE,eAAT,CAAyB3B,GAAzB,EAA8B4B,GAA9B,EAAmCC,IAAnC,EAAyC;AAAE;AACvC7B,QAAII,IAAJ,KAAa,iBAAb,IAAkCL,kBAAkB+B,IAAlB,CAAuB,IAAvB,EAA6B9B,GAA7B,CAAlC;AACA6B,SAAK7B,GAAL;AACH;;AAED,IAAM+B,aAAa,SAAbA,UAAa,SAAU;;AAEzBC,WAAOC,OAAP,CAAeC,UAAf,GAA4B,UAAS7B,OAAT,EAAkB;AAC1C,aAAKE,QAAL,GAAgBF,OAAhB;AACA,eAAO,IAAP;AACH,KAHD;;AAKA2B,WAAOG,IAAP,CAAY,UAAZ,EAAwBR,eAAxB;AACAK,WAAOG,IAAP,CAAY,kBAAZ,EAAgCR,eAAhC;AAEH,CAVD;;kBAYeI,U","file":"i18n.js","sourcesContent":["function translateMessages(err) {\r\n\r\n    let i18n, modelName;\r\n    if (this.constructor.name === \"Query\") {\r\n        i18n = this.options.i18n;\r\n        modelName = this.model.modelName;\r\n    } else if (this.constructor.name === \"model\") {\r\n        if (!this._options) return;\r\n        i18n = this._options.i18n;\r\n        modelName = this.constructor.modelName;\r\n    }\r\n\r\n    if (!i18n) return;\r\n\r\n    Object.keys(err.errors).forEach(key => {\r\n\r\n        const errorKey = err.errors[key];\r\n        const namespace = `model.${modelName}`;\r\n        const { path, kind, value, min, max, minLength, maxLength } = errorKey;\r\n        const fieldTranslationKey = `${namespace}:${path}.name`;\r\n        const fieldName = i18n.exists(fieldTranslationKey) && i18n.t(fieldTranslationKey);\r\n        \r\n        // Custom field message or general\r\n        errorKey.message = i18n.t([`${namespace}:${path}.validation.${kind}`, `validation:${kind}`], { fieldName, value, min, max, minLength, maxLength });\r\n        err.message = i18n.t(\"validation:default\");\r\n\r\n    });\r\n\r\n}\r\n\r\nfunction errorMiddleware(err, doc, next) { // eslint-disable-line no-unused-vars\r\n    err.name === 'ValidationError' && translateMessages.call(this, err);\r\n    next(err);\r\n}\r\n\r\nconst i18nPlugin = schema => {\r\n\r\n    schema.methods.setOptions = function(options) {\r\n        this._options = options;\r\n        return this;\r\n    };\r\n\r\n    schema.post(\"validate\", errorMiddleware);\r\n    schema.post(\"findOneAndUpdate\", errorMiddleware);\r\n\r\n};\r\n\r\nexport default i18nPlugin;"]}